{{ define "main" }}
  <article>
    <h1>{{ i18n "latest_posts" }}</h1>
    {{ with .Content -}}<div class="post-content">{{- . -}}</div>{{- end }}

    {{ $allPages := where .Site.RegularPages "Type" "!=" "page" }}
    {{ $latestPages := first 20 $allPages }}
    {{ if $latestPages }}
    <div class="posts-card-grid">
      {{ range $latestPages }}
      {{- $post := . }}
      <a class="post-card{{ if not .Params.images }} post-card--no-thumb{{ end }}" href="{{ .RelPermalink }}">
        {{- with .Params.images }}
        <div class="post-card-thumbnail">
          {{- $langPrefix := printf "/%s/" $post.Language.Lang -}}
          {{- $imgBase := $post.RelPermalink | strings.TrimPrefix $langPrefix | printf "/ko/%s" -}}
          <img src="{{ $imgBase }}{{ index . 0 }}" alt="" loading="lazy">
        </div>
        {{- end }}
        <div class="post-card-body">
          <span class="post-card-title">{{- .Title -}}</span>
          {{ with .Description | default .Summary }}<span class="post-card-summary">{{ . | plainify | truncate (cond (not $post.Params.images) 500 200) }}</span>{{ end }}
          <div class="post-card-footer">
            {{- with $post.GetTerms "categories" }}
            <span class="post-card-category">
              {{- range . }}{{ .Title }}{{- end }}
            </span>
            {{- end }}
            <span class="post-card-date">
              {{- if eq .Language.Lang "en" }}
              {{ .PublishDate.Format "Jan 2, 2006" }}
              {{- else if eq .Language.Lang "ja" }}
              {{ .PublishDate.Format "2006/01/02" }}
              {{- else }}
              {{ .PublishDate.Format "2006-01-02" }}
              {{- end }}
            </span>
          </div>
        </div>
      </a>
      {{ end }}
    </div>
    {{ end }}
  </article>
{{ end }}
